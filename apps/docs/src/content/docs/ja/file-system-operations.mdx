---
title: ファイルシステム操作
---

import { TabItem, Tabs } from '@astrojs/starlight/components'

DaytonaのTS SDK / Python SDKは、サンドボックス内の`fs`モジュールを通じて、充実したファイルシステム操作を提供します。本ガイドでは、利用可能なすべてのファイルシステム操作とベストプラクティスを解説します。

## 基本的な操作 \{#basic-operations\}

Daytona SDK では、サンドボックス内のファイルシステムを操作できます。ファイル一覧の取得、ディレクトリの作成、ファイルの読み書きなど、さまざまな操作が可能です。

簡単のため、ファイル操作は既定でサンドボックスユーザーのホームディレクトリ直下で行う想定です。たとえば `workspace` は `/home/[username]/workspace` を指します。必要に応じて、先頭をスラッシュ `/` で始める絶対パスの workDir を指定することもできます。

### ファイルとディレクトリの一覧 \{#listing-files-and-directories\}

Daytona SDK では、Python と TypeScript からサンドボックス内のファイルやディレクトリを一覧できます。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # ディレクトリ内のファイルを一覧する
    files = sandbox.fs.list_files("workspace")

    for file in files:
        print(f"Name: {file.name}")
        print(f"Is directory: {file.is_dir}")
        print(f"Size: {file.size}")
        print(f"Modified: {file.mod_time}")

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // ディレクトリ内のファイルを一覧する
    const files = await sandbox.fs.listFiles("workspace")

    files.forEach(file => {
        console.log(`Name: ${file.name}`)
        console.log(`Is directory: ${file.isDir}`)
        console.log(`Size: ${file.size}`)
        console.log(`Modified: ${file.modTime}`)
    })
    ```
  </TabItem>
</Tabs>

### ディレクトリの作成 \{#creating-directories\}

Daytona SDK では、Python と TypeScript から特定のパーミッションでディレクトリを作成できます。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # 特定のパーミッションで作成
    sandbox.fs.create_folder("workspace/new-dir", "755")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // 特定のパーミッションで作成
    await sandbox.fs.createFolder("workspace/new-dir", "755")
    ```
  </TabItem>
</Tabs>

### ファイルのアップロード \{#uploading-files\}

Daytona SDK は、Python と TypeScript を用いてサンドボックス内のファイルを読み取り、書き込み、アップロード、ダウンロード、削除できる機能を提供します。

#### 単一ファイルのアップロード \{#uploading-a-single-file\}

1つのファイルをアップロードする場合は、次のように実行します:

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # ファイルを1つアップロードする
    with open("local_file.txt", "rb") as f:
        content = f.read()
    sandbox.fs.upload_file(content, "remote_file.txt")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // ファイルを1つアップロードする
    const fileContent = Buffer.from('Hello, World!')
    await sandbox.fs.uploadFile(fileContent, "data.txt")
    ```
  </TabItem>
</Tabs>

#### 複数ファイルのアップロード \{#uploading-multiple-files\}

次の例では、1回のメソッド呼び出しで複数のファイルを効率的にアップロードする方法を示します。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # 複数のファイルをまとめてアップロードする
    files_to_upload = []

    with open("file1.txt", "rb") as f1:
        files_to_upload.append(FileUpload(
            source=f1.read(),
            destination="data/file1.txt",
        ))

    with open("file2.txt", "rb") as f2:
        files_to_upload.append(FileUpload(
            source=f2.read(),
            destination="data/file2.txt",
        ))

    with open("settings.json", "rb") as f3:
        files_to_upload.append(FileUpload(
            source=f3.read(),
            destination="config/settings.json",
        ))

    sandbox.fs.upload_files(files_to_upload)

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // 複数のファイルをまとめてアップロードする
    const files = [
        {
            source: Buffer.from('Content of file 1'),
            destination: 'data/file1.txt',
        },
        {
            source: Buffer.from('Content of file 2'),
            destination: 'data/file2.txt',
        },
        {
            source: Buffer.from('{"key": "value"}'),
            destination: 'config/settings.json',
        }
    ]

    await sandbox.fs.uploadFiles(files)
    ```
  </TabItem>
</Tabs>

### ファイルをダウンロードする \{#downloading-files\}

#### 単一ファイルのダウンロード \{#downloading-a-single-file\}

次のコマンドは、サンドボックスの作業ディレクトリから `file1.txt` をダウンロードし、その内容を出力します。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python

    content = sandbox.fs.download_file("file1.txt")

    with open("local_file.txt", "wb") as f:
        f.write(content)

    print(content.decode('utf-8'))

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript

    const downloadedFile = await sandbox.fs.downloadFile("file1.txt")

    console.log('File content:', downloadedFile.toString())

    ```
  </TabItem>
</Tabs>

#### 複数ファイルのダウンロード \{#downloading-multiple-files\}

次の例では、1回のメソッド呼び出しで複数のファイルを効率よくダウンロードする方法を示します。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # 複数のファイルを一度にダウンロード
    files_to_download = [
        FileDownloadRequest(source="data/file1.txt"), # 宛先指定なし - メモリにダウンロード
        FileDownloadRequest(source="data/file2.txt", destination="local_file2.txt"), # ローカルファイルに保存
    ]

    results = sandbox.fs.download_files(files_to_download)

    for result in results:
        if result.error:
            print(f"Error downloading {result.source}: {result.error}")
        elif result.result:
            print(f"Downloaded {result.source} to {result.result}")

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // 複数のファイルを一度にダウンロード
    const files = [
        { source: "data/file1.txt" }, // 宛先指定なし - メモリにダウンロード
        { source: "data/file2.txt", destination: "local_file2.txt" }, // ローカルファイルに保存
    ]

    const results = await sandbox.fs.downloadFiles(files)

    results.forEach(result => {
        if (result.error) {
            console.error(`Error downloading ${result.source}: ${result.error}`)
        } else if (result.result) {
            console.log(`Downloaded ${result.source} to ${result.result}`)
        }
    })
    ```
  </TabItem>
</Tabs>

### ファイルの削除 \{#deleting-files\}

不要になったファイルは、`delete_file` 関数で削除できます。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python

    sandbox.fs.delete_file("workspace/file.txt")

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript

    await sandbox.fs.deleteFile("workspace/file.txt")
    ```
  </TabItem>
</Tabs>

## 高度な操作 \{#advanced-operations\}

Daytona SDK は、ファイルのアクセス権や検索・置換など、より高度なファイルシステム操作を提供します。

### ファイル権限 \{#file-permissions\}

Daytona SDK は、Python と TypeScript でファイル権限の設定・取得、およびディレクトリ権限の再帰的設定を行う機能を提供します。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # ファイル権限を設定
    sandbox.fs.set_file_permissions("workspace/file.txt", "644")

    # ファイル権限を取得
    file_info = sandbox.fs.get_file_info("workspace/file.txt")
    print(f"Permissions: {file_info.permissions}")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // ファイル権限を設定
    await sandbox.fs.setFilePermissions("workspace/file.txt", { mode: "644" })

    // ファイル権限を取得
    const fileInfo = await sandbox.fs.getFileDetails("workspace/file.txt")
    console.log(`Permissions: ${fileInfo.permissions}`)
    ```
  </TabItem>
</Tabs>

### ファイル検索と置換 \{#file-search-and-replace\}

Daytona SDK では、Python と TypeScript から、ファイル内テキストの検索および置換を行う機能を提供しています。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # ファイル内のテキストを検索します。フォルダを指定した場合は再帰的に検索されます
    results = sandbox.fs.find_files(
        path="workspace/src",
        pattern="text-of-interest"
    )
    for match in results:
        print(f"Absolute file path: {match.file}")
        print(f"Line number: {match.line}")
        print(f"Line content: {match.content}")
        print("\n")

    # ファイル内のテキストを置換します
    sandbox.fs.replace_in_files(
        files=["workspace/file1.txt", "workspace/file2.txt"],
        pattern="old_text",
        new_value="new_text"
    )
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // ファイル内のテキストを検索します。フォルダを指定した場合は再帰的に検索されます
    const results = await sandbox.fs.findFiles({
        path: "workspace/src",
        pattern: "text-of-interest"
    })
    results.forEach(match => {
        console.log('Absolute file path:', match.file)
        console.log('Line number:', match.line)
        console.log('Line content:', match.content)
    })

    // ファイル内のテキストを置換します
    await sandbox.fs.replaceInFiles(
        ["workspace/file1.txt", "workspace/file2.txt"],
        "old_text",
        "new_text"
    )
    ```
  </TabItem>
</Tabs>