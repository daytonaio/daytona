---
title: プロセスとコード実行
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

Daytona SDKは、サンドボックス内の`process`モジュールを通じて、強力なプロセスとコード実行の機能を提供します。本ガイドでは、利用可能なすべてのプロセス操作とベストプラクティスを紹介します。

## コード実行 \{#code-execution\}

Daytona SDK は、Python と TypeScript でコードを実行するための機能を提供します。

:::note
コード実行に使用される言語は、サンドボックス作成時に指定されたサンドボックスの言語によって決まります。詳細は、[サンドボックスの基本的な作成方法](/docs/ja/sandbox-management/#basic-sandbox-creation) を参照してください。
:::

### コードの実行 \{#running-code\}

Daytona SDK では、Python と TypeScript のコードスニペットを実行できます。入力、タイムアウト、環境変数を指定してコードを実行可能です。

<Tabs syncKey="language">
  <TabItem label="Python" icon="seti:python">
    ```python
    # Python コードを実行
    response = sandbox.process.code_run('''
    def greet(name):
        return f"Hello, {name}!"

    print(greet("Daytona"))
    ''')

    print(response.result)

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // TypeScript コードを実行
    let response = await sandbox.process.codeRun(`
    function greet(name: string): string {
        return \`Hello, \${name}!\`;
    }

    console.log(greet("Daytona"));
    `);
    console.log(response.result);

    // argv と環境変数を指定してコードを実行
    response = await sandbox.process.codeRun(
        `
        console.log(\`Hello, \${process.argv[2]}!\`);
        console.log(\`FOO: \${process.env.FOO}\`);
        `,
        { 
          argv: ["Daytona"],
          env: { FOO: "BAR" }
        }
    );
    console.log(response.result);

    // タイムアウトを指定してコードを実行
    response = await sandbox.process.codeRun(
        'setTimeout(() => console.log("Done"), 2000);',
        undefined,
        5000
    );
    console.log(response.result);
    ```
  </TabItem>
</Tabs>

参照: [code&#95;run（Python SDK）](/docs/python-sdk/sync/process/#processcode_run), [codeRun（TypeScript SDK）](/docs/typescript-sdk/process/#coderun)

## プロセス実行 \{#process-execution\}

Daytona SDK は、サンドボックス内でシェルコマンドを実行し、バックグラウンドプロセスを管理する機能を提供します。実行時の workDir は、既定で現在のサンドボックスの作業ディレクトリです。Dockerfile に WORKDIR が指定されていればそれが使われ、指定がない場合はユーザーのホームディレクトリが用いられます。例: `workspace/repo` は `/my-work-dir/workspace/repo` を意味しますが、パスを `/` で始めることで絶対パスにして上書きできます。

### コマンドの実行 \{#running-commands\}

Daytona SDK は、Python と TypeScript でシェルコマンドを実行する手段を提供します。入力、タイムアウト、環境変数を指定してコマンドを実行できます。

<Tabs syncKey="language">
  <TabItem label="Python" icon="seti:python">
    ```python
    # 任意のシェルコマンドを実行
    response = sandbox.process.exec("ls -la")
    print(response.result)

    # 作業ディレクトリとタイムアウトを設定
    response = sandbox.process.exec("sleep 3", cwd="workspace/src", timeout=5)
    print(response.result)

    # 環境変数を渡す
    response = sandbox.process.exec("echo $CUSTOM_SECRET", env={
            "CUSTOM_SECRET": "DAYTONA"
        }
    )
    print(response.result)

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript

    // 任意のシェルコマンドを実行
    const response = await sandbox.process.executeCommand("ls -la");
    console.log(response.result);

    // 作業ディレクトリとタイムアウトを設定
    const response2 = await sandbox.process.executeCommand("sleep 3", "workspace/src", undefined, 5);
    console.log(response2.result);

    // 環境変数を渡す
    const response3 = await sandbox.process.executeCommand("echo $CUSTOM_SECRET", ".", {
            "CUSTOM_SECRET": "DAYTONA"
        }
    );
    console.log(response3.result);

    ```
  </TabItem>
</Tabs>

参照: [exec (Python SDK)](/docs/python-sdk/sync/process/#processexec), [executeCommand (TypeScript SDK)](/docs/typescript-sdk/process/#executecommand)

## セッション（バックグラウンドプロセス） \{#sessions-background-processes\}

Daytona SDK は、サンドボックス内のバックグラウンドプロセスセッションの開始・停止・管理に対応しています。長時間実行されるコマンドを実行し、プロセスの状態を監視し、稼働中のプロセスを一覧できます。

### 長時間実行プロセスの管理 \{#managing-long-running-processes\}

Daytona SDK はバックグラウンドプロセスの開始・停止を行う機能を提供します。長時間実行するコマンドを実行し、プロセスの状態を監視できます。

<Tabs syncKey="language">
  <TabItem label="Python" icon="seti:python">
    ```python
    # セッションで実行されたコマンドを確認
    session = sandbox.process.get_session(session_id)
    print(f"Session {session_id}:")
    for command in session.commands:
        print(f"Command: {command.command}, Exit Code: {command.exit_code}")

    # 実行中のすべてのセッションを一覧表示
    sessions = sandbox.process.list_sessions()
    for session in sessions:
        print(f"PID: {session.id}, Commands: {session.commands}")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // セッションで実行されたコマンドを確認
    const session = await sandbox.process.getSession(sessionId);
    console.log(`Session ${sessionId}:`);
    for (const command of session.commands) {
        console.log(`Command: ${command.command}, Exit Code: ${command.exitCode}`);
    }

    // 実行中のすべてのセッションを一覧表示
    const sessions = await sandbox.process.listSessions();
    for (const session of sessions) {
        console.log(`PID: ${session.id}, Commands: ${session.commands}`);
    }
    ```
  </TabItem>
</Tabs>

参照: [get&#95;session (Python SDK)](/docs/python-sdk/sync/process/#processget_session), [list&#95;sessions (Python SDK)](/docs/python-sdk/sync/process/#processlist_sessions), [getSession (TypeScript SDK)](/docs/typescript-sdk/process/#getsession), [listSessions (TypeScript SDK)](/docs/typescript-sdk/process/#listsessions)

## ベストプラクティス \{#best-practices\}

Daytona SDK でプロセスやコードの実行を扱う際は、次のベストプラクティスに従ってください。

### リソース管理 \{#resource-management\}

プロセス実行時のリソース管理には、次のベストプラクティスが適用されます：

1. 長時間実行の処理には[セッション](#sessions-background-processes)を使用する
2. 実行後はセッションを後片付け（クリーンアップ）する
3. セッションで発生する例外を適切に処理する

<Tabs syncKey="language">
  <TabItem label="Python" icon="seti:python">
    ```python
    # Python - セッションのクリーンアップ
    session_id = "long-running-cmd"
    try:
        sandbox.process.create_session(session_id)
        session = sandbox.process.get_session(session_id)
        # Do work...
    finally:
        sandbox.process.delete_session(session.session_id)
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // TypeScript - セッションのクリーンアップ
    const sessionId = "long-running-cmd";
    try {
        await sandbox.process.createSession(sessionId);
        const session = await sandbox.process.getSession(sessionId);
        // Do work...
    } finally {
        await sandbox.process.deleteSession(session.sessionId);
    }
    ```
  </TabItem>
</Tabs>

参照：[create&#95;session（Python SDK）](/docs/python-sdk/sync/process/#processcreate_session)、[delete&#95;session（Python SDK）](/docs/python-sdk/sync/process/#processdelete_session)、[createSession（TypeScript SDK）](/docs/typescript-sdk/process/#createsession)、[deleteSession（TypeScript SDK）](/docs/typescript-sdk/process/#deletesession)

### エラー処理 \{#error-handling\}

プロセス実行時のエラー処理には、次のベストプラクティスが有効です:

* プロセスで発生した例外を適切に処理する
* デバッグのためにエラーの詳細をログに記録する
* エラー処理には try-catch ブロックを使用する

<Tabs syncKey="language">
  <TabItem label="Python" icon="seti:python">
    ```python
    try:
        response = sandbox.process.code_run("invalid python code")
    except ProcessExecutionError as e:
        print(f"Execution failed: {e}")
        print(f"Exit code: {e.exit_code}")
        print(f"Error output: {e.stderr}")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    try {
        const response = await sandbox.process.codeRun("invalid typescript code");
    } catch (e) {
        if (e instanceof ProcessExecutionError) {
            console.error("Execution failed:", e);
            console.error("Exit code:", e.exitCode);
            console.error("Error output:", e.stderr);
        }
    }
    ```
  </TabItem>
</Tabs>

## よくある問題 \{#common-issues\}

プロセスやコード実行に関するよくある問題のトラブルシューティングは、次の表を参照してください。

| 問題 | 解決策 |
|-------|-----------|
| `Process Execution Failed` | ・コマンドの構文を確認する<br />・必要な依存関係を確認する<br />・必要な権限が付与されていることを確認する |
| `Process Timeout` | ・タイムアウト設定を調整する<br />・長時間実行タスクを最適化する<br />・バックグラウンド処理の利用を検討する |
| `Resource Limits` | ・プロセスのメモリ使用量を監視する<br />・プロセスの後処理（クリーンアップ）を適切に行う<br />・適切なリソース制限を設定する |