---
title: プロセスとコード実行
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

Daytona SDKは、サンドボックス内の`process`モジュールを通じて、強力なプロセスとコード実行の機能を提供します。本ガイドでは、利用可能なすべてのプロセス操作とベストプラクティスを紹介します。

## プロセスとコード実行 \{#code-execution\}

Daytona SDK は、Python と TypeScript でコードを実行する機能を提供します。

### コードの実行 \{#running-code\}

Daytona SDK では、Python と TypeScript のコードスニペットを実行できます。入力、タイムアウト、環境変数を指定してコードを実行可能です。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # Python コードを実行
    response = sandbox.process.code_run('''
    def greet(name):
        return f"Hello, {name}!"

    print(greet("Daytona"))
    ''')

    print(response.result)

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // TypeScript コードを実行
    let response = await sandbox.process.codeRun(`
    function greet(name: string): string {
        return \`Hello, \${name}!\`;
    }

    console.log(greet("Daytona"));
    `);
    console.log(response.result);

    // argv と環境変数を指定してコードを実行
    response = await sandbox.process.codeRun(
        `
        console.log(\`Hello, \${process.argv[2]}!\`);
        console.log(\`FOO: \${process.env.FOO}\`);
        `,
        { 
          argv: ["Daytona"],
          env: { FOO: "BAR" }
        }
    );
    console.log(response.result);

    // タイムアウトを指定してコードを実行
    response = await sandbox.process.codeRun(
        'setTimeout(() => console.log("Done"), 2000);',
        undefined,
        5000
    );
    console.log(response.result);
    ```
  </TabItem>
</Tabs>

## プロセス実行 \{#process-execution\}

Daytona SDK は、サンドボックス内でシェルコマンドを実行し、バックグラウンドプロセスを管理する機能を提供します。実行時の workDir は、既定で現在のサンドボックスの作業ディレクトリです。Dockerfile に WORKDIR が指定されていればそれが使われ、指定がない場合はユーザーのホームディレクトリが用いられます。例: `workspace/repo` は `/my-work-dir/workspace/repo` を意味しますが、パスを `/` で始めることで絶対パスにして上書きできます。

### コマンドの実行 \{#running-commands\}

Daytona SDK では、Python と TypeScript からシェルコマンドを実行できます。入力、タイムアウト、環境変数を指定してコマンドを実行可能です。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # 任意のシェルコマンドを実行
    response = sandbox.process.exec("ls -la")
    print(response.result)

    # 作業ディレクトリとタイムアウトを設定
    response = sandbox.process.exec("sleep 3", cwd="workspace/src", timeout=5)
    print(response.result)

    # 環境変数を渡す
    response = sandbox.process.exec("echo $CUSTOM_SECRET", env={
            "CUSTOM_SECRET": "DAYTONA"
        }
    )
    print(response.result)

    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript

    // 任意のシェルコマンドを実行
    const response = await sandbox.process.executeCommand("ls -la");
    console.log(response.result);

    // 作業ディレクトリとタイムアウトを設定
    const response2 = await sandbox.process.executeCommand("sleep 3", "workspace/src", undefined, 5);
    console.log(response2.result);

    // 環境変数を渡す
    const response3 = await sandbox.process.executeCommand("echo $CUSTOM_SECRET", ".", {
            "CUSTOM_SECRET": "DAYTONA"
        }
    );
    console.log(response3.result);

    ```
  </TabItem>
</Tabs>

## セッション（バックグラウンドプロセス） \{#sessions-background-processes\}

Daytona SDK は、サンドボックス内のバックグラウンドプロセスセッションの開始・停止・管理に対応しています。長時間実行されるコマンドを実行し、プロセスの状態を監視し、稼働中のプロセスを一覧できます。

### 長時間実行プロセスの管理 \{#managing-long-running-processes\}

Daytona SDK では、バックグラウンドプロセスの開始・停止が可能です。長時間実行するコマンドを実行し、プロセスの状態を監視できます。

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # セッションで実行されたコマンドを確認
    session = sandbox.process.get_session(session_id)
    print(f"Session {session_id}:")
    for command in session.commands:
        print(f"Command: {command.command}, Exit Code: {command.exit_code}")

    # 実行中のすべてのセッションを一覧表示
    sessions = sandbox.process.list_sessions()
    for session in sessions:
        print(f"PID: {session.id}, Commands: {session.commands}")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // セッションで実行されたコマンドを確認
    const session = await sandbox.process.getSession(sessionId);
    console.log(`Session ${sessionId}:`);
    for (const command of session.commands) {
        console.log(`Command: ${command.command}, Exit Code: ${command.exitCode}`);
    }

    // 実行中のすべてのセッションを一覧表示
    const sessions = await sandbox.process.listSessions();
    for (const session of sessions) {
        console.log(`PID: ${session.id}, Commands: ${session.commands}`);
    }
    ```
  </TabItem>
</Tabs>

## ベストプラクティス \{#best-practices\}

Daytona SDK では、サンドボックス内でのプロセスおよびコード実行に関するベストプラクティスを提供しています。

1. **リソース管理**

* 長時間実行の処理にはセッションを使用する
* 実行後はセッションを確実にクリーンアップする
* セッションで発生した例外を適切に処理する

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    # Python - セッションのクリーンアップ
    session_id = "long-running-cmd"
    try:
        sandbox.process.create_session(session_id)
        session = sandbox.process.get_session(session_id)
        # 処理を実行...
    finally:
        sandbox.process.delete_session(session.session_id)
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    // TypeScript - セッションのクリーンアップ
    const sessionId = "long-running-cmd";
    try {
        await sandbox.process.createSession(sessionId);
        const session = await sandbox.process.getSession(sessionId);
        // 処理を実行...
    } finally {
        await sandbox.process.deleteSession(session.sessionId);
    }
    ```
  </TabItem>
</Tabs>

2. **エラーハンドリング**

* プロセス例外を適切に処理する
* デバッグのためにエラー詳細をログ出力する
* エラーハンドリングには try-catch ブロックを使用する

<Tabs>
  <TabItem label="Python" icon="seti:python">
    ```python
    try:
        response = sandbox.process.code_run("invalid python code")
    except ProcessExecutionError as e:
        print(f"Execution failed: {e}")
        print(f"Exit code: {e.exit_code}")
        print(f"Error output: {e.stderr}")
    ```
  </TabItem>

  <TabItem label="TypeScript" icon="seti:typescript">
    ```typescript
    try {
        const response = await sandbox.process.codeRun("invalid typescript code");
    } catch (e) {
        if (e instanceof ProcessExecutionError) {
            console.error("Execution failed:", e);
            console.error("Exit code:", e.exitCode);
            console.error("Error output:", e.stderr);
        }
    }
    ```
  </TabItem>
</Tabs>

## よくある問題 \{#common-issues\}

Daytona SDK には、プロセスとコード実行に関するよくある問題をトラブルシューティングするためのオプションがあります。

### プロセス実行に失敗しました \{#process-execution-failed\}

* コマンドの構文を確認する
* 必要な依存関係が揃っているか確認する
* 必要な権限があるか確認する

### プロセスのタイムアウト \{#process-timeout\}

* タイムアウト設定を調整する
* 長時間実行の処理を最適化する
* バックグラウンド処理の活用を検討する

### リソース制限 \{#resource-limits\}

* プロセスのメモリ使用量を監視する
* プロセスのクリーンアップを適切に行う
* 適切なリソース制約を設定する