---
title: レート制限
---

Daytona は、すべてのユーザーに公平な利用機会を提供し、プラットフォームの安定性と最適なパフォーマンスを維持するために API レート制限を適用します。レート制限は、認証状況と実行する操作の種類に基づいて適用されます。

## 概要 \{#overview\}

レート制限は、一定期間内に行える API リクエストの数を制御します。これらの制限を正しく理解することで、レート制限を適切に処理し、サービスの中断を防ぐ堅牢なアプリケーションを構築できます。

## レート制限の種類 \{#rate-limit-types\}

Daytona には、互いに独立したカウンターで管理される 4 つのレート制限カテゴリがあります。

| 種類 | 上限 | 時間枠 | 対象 |
|------|-------|-------------|------------|
| **Anonymous Requests** | 300 リクエスト | 60 秒 | 未認証の API 呼び出し |
| **Authenticated Requests** | 40,000 リクエスト | 60 秒 | 一般的な認証済み API 呼び出し |
| **Sandbox Creation** | 300 リクエスト | 60 秒 | 新規サンドボックスの作成 |
| **Sandbox Lifecycle** | 40,000 リクエスト | 60 秒 | 開始、停止、削除、アーカイブなどの操作 |

## 匿名リクエスト \{#anonymous-requests\}

**60 秒あたり 300 リクエスト**

このレート制限は、認証されていないすべての API リクエストに適用されます。匿名リクエストは IP アドレス単位で追跡され、次を含みます。

* API キーや認証トークンを使用しない公開エンドポイント
* Daytona API への認証されていないリクエスト

***

## 認証済みリクエスト \{#authenticated-requests\}

**60 秒あたり 40,000 リクエスト**

これは、サンドボックスの作成やライフサイクル操作に該当しない認証済み API リクエストに対する、一般的なレート制限です。これには次のものが含まれます:

* サンドボックスの一覧取得
* サンドボックス詳細の取得
* サンドボックスリージョンの取得
* スナップショットの一覧取得
* ボリュームの管理
* 監査ログの閲覧
* その他の読み取り・管理系の操作

認証済みリクエストのレート制限は、組織ごとに管理されています。

***

## サンドボックスの作成 \{#sandbox-creation\}

**60 秒あたり 300 リクエスト（1 秒あたり 5 リクエスト）**

このレート制限は、スナップショットからの作成、宣言的ビルド、`daytona.create()`（SDK）に渡されるその他のパラメーター、または `/api/sandbox`（API）への POST リクエストなど、すべてのサンドボックス作成方法に適用されます。

このサンドボックス作成専用の制限により、リソースの枯渇を防ぎつつ、既存のサンドボックスに対するライフサイクル操作は制限なく実行できます。

:::note
ご利用のユースケースで、より高いレートでサンドボックスを作成する必要がある場合は、カスタムレート制限についてご相談いただくために [support@daytona.io](mailto:support@daytona.io) までご連絡ください。
:::

***

## サンドボックスのライフサイクル操作 \{#sandbox-lifecycle-operations\}

**60 秒あたり 40,000 リクエスト**

このレート制限は、既存のサンドボックスに対するライフサイクルおよび状態管理の操作に適用されます：

* サンドボックスの**開始**（`POST /api/sandbox/:id/start`）
* サンドボックスの**停止**（`POST /api/sandbox/:id/stop`）
* サンドボックスの**削除**（`DELETE /api/sandbox/:id`）
* サンドボックスの**アーカイブ**（`POST /api/sandbox/:id/archive`）

および、これらに対応するすべての SDK メソッドにも適用されます。

これらの操作は、開発ワークフロー中に高い頻度で実行されることが多いため、上限が高めに設定されています。

***

## 制限に達したときの挙動 \{#what-happens-when-you-hit-the-limit\}

レート制限を超過すると、以降のリクエストは次の内容で失敗します。

* **HTTP ステータス**: `429 Too Many Requests`
* **エラーレスポンス**: レート制限の詳細を含む JSON ボディ
* **Retry-After ヘッダー**: 再試行まで待機する時間（秒単位）

### SDK の動作 \{#sdk-behavior\}

公式の Daytona SDK を使用している場合:

* **TypeScript SDK**: `RateLimitError` をスローします
* **Python SDK**: `RateLimitException` をスローします

### エラーレスポンスの例 \{#example-error-response\}

```json
{
  "statusCode": 429,
  "message": "レート制限を超過しました",
  "error": "リクエスト数が多すぎます"
}
```

***

## レート制限ヘッダー \{#rate-limit-headers\}

Daytona は API レスポンスヘッダーにレート制限情報を含めています。

| ヘッダー名 | 説明 |
|--------|-------------|
| `X-RateLimit-Limit` | 指定された時間ウィンドウ内で許可される最大リクエスト数 |
| `X-RateLimit-Remaining` | 現在のウィンドウで残っているリクエスト数 |
| `X-RateLimit-Reset` | レート制限ウィンドウがリセットされるまでの秒数 |
| `Retry-After` | 再試行までに待機する秒数（制限を超過した場合に返されます） |

## ベストプラクティス \{#best-practices\}

レート制限の範囲内で効率的に動作させるために、`429` エラーが発生した場合は、必ず適切なリトライロジックで丁寧に処理してください。レート制限エラーを受け取ったら、指数バックオフを実装し、API に過度な負荷をかけないようにリトライの間隔を徐々に長くして待機します（1 秒、2 秒、4 秒、8 秒など）。以下はその例です。

```typescript
async function createSandboxWithRetry() {
  let retries = 0
  const maxRetries = 5
  
  while (retries < maxRetries) {
    try {
      return await daytona.create({ snapshot: 'my-snapshot' })
    } catch (error) {
      if (error.statusCode === 429 && retries < maxRetries - 1) {
        const delay = Math.pow(2, retries) * 1000 // 1秒、2秒、4秒、8秒、16秒の遅延
        await new Promise(resolve => setTimeout(resolve, delay))
        retries++
      } else {
        throw error
      }
    }
  }
}
```

**レート制限ヘッダー**（`X-RateLimit-Remaining`、`X-RateLimit-Reset`）を監視して利用状況を把握し、上限に達する前に事前のスロットリングを実装してください。

**頻繁に変化しない API レスポンスをキャッシュ**してください。たとえば、（比較的静的な）サンドボックス一覧、利用可能なリージョン、スナップショット情報などです。これにより不要な API 呼び出しが減り、レート制限の範囲内に余裕を持って収まるようになります。

**処理をバッチ化して最適化**し、逐次ではなく（レート制限の範囲内で）複数のサンドボックスを並列に作成します。可能な場合は、すべてのタスクごとに新しいサンドボックスを作成するのではなく、既存のサンドボックスを再利用することを検討してください。

**サンドボックスのライフサイクルを効率的に管理**して API 呼び出しを削減します。サンドボックスを削除して再作成するのではなくアーカイブしたり、未使用時には削除するのではなく停止したりし、[自動停止間隔](/docs/ja/sandbox-management#auto-stop)を活用して、手動操作なしで実行中のサンドボックスを自動的に管理してください。

**リクエストのキューイングを実装**して、上限を超えるバーストを防ぎ、状態変化の検出にはポーリングではなく [webhook](/docs/ja/webhooks) を使用して不要な API 呼び出しを避けてください。アプリケーションのログ内で `429` エラーを監視しアラートを設定して、ユーザーへの影響が出る前にレート制限の問題へプロアクティブに対処できるようにしてください。

***

## カスタムレート制限 \{#custom-rate-limits\}

現在、レート制限はすべての組織ティアで共通です。ただし、ユースケースによってより高いレート制限が必要な場合は、以下のような用途向けにカスタムレート制限を提供しています。

* **高トラフィックアプリケーション**（1分あたり300件を超えるサンドボックス作成が必要な場合）
* **エンタープライズ環境**（特定のスループット要件がある場合）
* **カスタム連携**（固有のレート制限要件がある場合）

要件に合わせたカスタムレート制限については、[support@daytona.io](mailto:support@daytona.io) までお問い合わせください。

***

## お困りですか？ \{#need-help\}

レート制限の問題が発生している場合やサポートが必要な場合は、次の手順をお試しください。

1. 現在の[API利用状況](https://app.daytona.io/dashboard)を確認する
2. 最適化のための戦略について、このドキュメントを確認する
3. サポートのご利用やカスタムレート制限のご相談は [support@daytona.io](mailto:support@daytona.io) までお問い合わせください